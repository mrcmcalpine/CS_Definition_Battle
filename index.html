<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Word Guess Challenge üåø</title>
<style>
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg,#6a11cb,#2575fc); color:#fff; text-align:center; padding:20px; min-height:100vh; display:flex; flex-direction:column; align-items:center; }
h1 { font-size:2.2rem; margin-bottom:14px }
#clueBox,#wordBox,#livesBox,#scoreBox,#feedback,#incorrectWordsBox { margin:10px 0; font-size:1.2rem; }
#clueBox { text-align:left; max-width:560px }
.clue { opacity:0; transform:translateY(10px); animation:fadeIn .45s ease forwards; margin:6px 0; padding:8px 12px; background:rgba(255,255,255,0.12); border-radius:8px }
@keyframes fadeIn { to { opacity:1; transform:translateY(0) } }
#wordBox { font-size:2rem; letter-spacing:8px; font-weight:700 }
input[type=text] { padding:10px; font-size:1.1rem; border-radius:8px; border:none; outline:none; width:260px; text-align:center }
button { padding:10px 18px; font-size:1rem; border:none; border-radius:20px; margin:6px; cursor:pointer; background:#fff; color:#2575fc; font-weight:700 }
button:hover { transform:scale(1.04) }
#leaderboard { margin-top:20px; background:rgba(255,255,255,0.08); padding:14px; border-radius:12px; width:320px }
#leaderboardList { list-style:none; padding:0; text-align:left }
#incorrectWordsBox { text-align:left; max-width:560px; background: rgba(0,0,0,0.15); padding:10px; border-radius:8px; display:none; }
.extra-life { animation: popLife 0.8s ease; color: #ffeb3b; font-weight: bold; }
.correct-guess { animation: correctFlash 0.8s ease; color: #4caf50; font-weight: bold; }
@keyframes popLife { 0% {transform: scale(1);} 50% {transform: scale(1.4);} 100% {transform: scale(1);} }
@keyframes correctFlash { 0% {opacity: 0;} 50% {opacity: 1;} 100% {opacity:0;} }
#extraClues { margin-top:10px; text-align:left; max-width:560px; }
</style>
</head>
<body>
<h1>Word Guess Challenge üåø</h1>

<div id="namePrompt">
  Enter your name: <input type="text" id="playerNameInput" placeholder="Your name">
  <button id="submitNameBtn">Submit</button>
</div>

<div id="gameUI" style="display:none;">
  <div id="clueBox">Press Start to begin!</div>
  <div id="wordBox"></div>
  <div id="livesBox">Lives: 5</div>
  <input type="text" id="guessInput" placeholder="Type your guess here..." disabled>
  <div>
    <button id="submitBtn" disabled>Submit</button>
    <button id="startBtn">Start Game</button>
    <button id="playAgainBtn" style="display:none;">Play Again</button>
  </div>
  <div id="feedback"></div>
  <div id="extraClues"></div>
  <div id="scoreBox">Score: 0</div>
  <div id="incorrectWordsBox"></div>
  <div id="leaderboard">
    <h3>Leaderboard üèÜ</h3>
    <ul id="leaderboardList"></ul>
  </div>
</div>

<script>
const WORDS_JSON_PATH = './words.json';

let words = [], currentWord = null, clueIndex = 0, score = 0, lives = 5;
let revealedLetters = [], gameStarted = false, playerName = '';
let incorrectWords = [], consecutiveFirstGuessCount = 0, wrongGuessesForWord = 0;

const namePrompt = document.getElementById('namePrompt');
const playerNameInput = document.getElementById('playerNameInput');
const submitNameBtn = document.getElementById('submitNameBtn');
const gameUI = document.getElementById('gameUI');
const clueBox = document.getElementById('clueBox');
const wordBox = document.getElementById('wordBox');
const livesBox = document.getElementById('livesBox');
const guessInput = document.getElementById('guessInput');
const submitBtn = document.getElementById('submitBtn');
const startBtn = document.getElementById('startBtn');
const playAgainBtn = document.getElementById('playAgainBtn');
const scoreBox = document.getElementById('scoreBox');
const feedback = document.getElementById('feedback');
const leaderboardList = document.getElementById('leaderboardList');
const incorrectWordsBox = document.getElementById('incorrectWordsBox');
const extraClues = document.getElementById('extraClues');

async function loadWords() {
  try {
    const res = await fetch(WORDS_JSON_PATH);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    words = await res.json();
    if (!Array.isArray(words) || words.length === 0) throw new Error('words.json must be a non-empty array');
  } catch(err) {
    clueBox.textContent = 'Error loading words.json ‚Äî make sure it is in the same folder as index.html and valid JSON.';
    console.error(err);
  }
}

function normalize(text) { return text.toLowerCase().replace(/[^a-z0-9]/gi,''); }

function displayWordProgress() {
  if (!currentWord) return;
  let display = '';
  for (let i = 0; i < currentWord.answer.length; i++) {
    const char = currentWord.answer[i];
    if (/[^a-zA-Z0-9]/.test(char)) display += char + ' ';
    else display += (revealedLetters[i] ? char : '_') + ' ';
  }
  wordBox.textContent = display.trim();
}

function showClues() {
  clueBox.innerHTML = '';
  for (let i = 0; i <= clueIndex; i++) {
    if (currentWord && currentWord.clues[i]) {
      const d = document.createElement('div');
      d.className = 'clue';
      d.textContent = `Clue ${i+1}: ${currentWord.clues[i]}`;
      clueBox.appendChild(d);
    }
  }
}

function pickWord() {
  if (!words.length) return;
  currentWord = words[Math.floor(Math.random() * words.length)];
  clueIndex = 0; revealedLetters = Array.from({ length: currentWord.answer.length }, ()=>false);
  wrongGuessesForWord = 0;
  displayWordProgress();
  hideIncorrectWordsBox();
  showClues();
  feedback.textContent = '';
  extraClues.innerHTML = '';
  guessInput.value = '';
  guessInput.maxLength = currentWord.answer.length;
}

function revealRandomLetters(count){
  if(!currentWord) return;
  const unrevealed = [];
  for(let i=0;i<currentWord.answer.length;i++){
    const c=currentWord.answer[i];
    if(!revealedLetters[i] && /[a-zA-Z0-9]/.test(c)) unrevealed.push(i);
  }
  for(let n=0;n<count && unrevealed.length>0;n++){
    const idx=Math.floor(Math.random()*unrevealed.length);
    revealedLetters[unrevealed[idx]]=true;
    unrevealed.splice(idx,1);
  }
  displayWordProgress();
}

function showIncorrectWordsOnDeath(){
  if(!incorrectWords.length){
    incorrectWordsBox.style.display='block';
    incorrectWordsBox.textContent='No incorrect words this run.';
    return;
  }
  incorrectWordsBox.style.display='block';
  incorrectWordsBox.innerHTML='<strong>Words you got wrong:</strong><br>'+incorrectWords.join(', ');
}

function hideIncorrectWordsBox(){ incorrectWordsBox.style.display='none'; incorrectWordsBox.innerHTML=''; }

function getPointsForClueIndex(idx){
  if(idx===0) return 5;
  if(idx===1) return 3;
  if(idx===2) return 1;
  return 0;
}

function saveLocalLeaderboardEntry(name,value){
  if(!name) return;
  let board=JSON.parse(localStorage.getItem('leaderboard')||'[]');
  board.push({name,score:value,ts:new Date().toISOString()});
  board.sort((a,b)=>b.score-a.score);
  board=board.slice(0,10);
  localStorage.setItem('leaderboard',JSON.stringify(board));
}

function displayLocalLeaderboard(){
  const board=JSON.parse(localStorage.getItem('leaderboard')||'[]');
  leaderboardList.innerHTML='';
  board.forEach((e,i)=>{
    const li=document.createElement('li');
    li.textContent=`${i+1}. ${e.name} - ${e.score}`;
    leaderboardList.appendChild(li);
  });
}

function checkGuess(){
  if(!gameStarted||!currentWord) return;
  const guess=normalize(guessInput.value.trim());
  const answer=normalize(currentWord.answer);
  if(!guess) return;

  if(guess===answer){
    const points=getPointsForClueIndex(clueIndex);
    score+=points;
    scoreBox.textContent=`Score: ${score}`;
    feedback.textContent=`‚úÖ Correct! +${points} points.`;
    feedback.classList.add('correct-guess');
    setTimeout(()=>feedback.classList.remove('correct-guess'),1000);

    if(clueIndex===0) consecutiveFirstGuessCount++;
    else consecutiveFirstGuessCount=0;

    setTimeout(()=>pickWord(),900);
  } else {
    wrongGuessesForWord++;
    revealRandomLetters(wrongGuessesForWord); // progressive reveal
    clueIndex++; lives--;
    livesBox.textContent=`Lives: ${lives}`;
    feedback.textContent='‚ùå Wrong!';
    if(!incorrectWords.includes(currentWord.answer)) incorrectWords.push(currentWord.answer);

    if(lives<=0){
      feedback.textContent=`üíÄ Game Over!`;
      guessInput.disabled=true; submitBtn.disabled=true; playAgainBtn.style.display='inline-block';
      gameStarted=false;
      showIncorrectWordsOnDeath();
      saveLocalLeaderboardEntry(playerName,score);
      displayLocalLeaderboard();
      return;
    }
    showClues();
  }
  guessInput.value=''; extraClues.innerHTML='';
}

submitNameBtn.addEventListener('click',async()=>{
  const name=playerNameInput.value.trim();
  if(!name){alert('Enter a display name'); return;}
  playerName=name;
  namePrompt.style.display='none'; gameUI.style.display='block';
  score=0; lives=5; incorrectWords=[]; consecutiveFirstGuessCount=0; wrongGuessesForWord=0;
  scoreBox.textContent=`Score: ${score}`; livesBox.textContent=`Lives: ${lives}`;
  guessInput.disabled=false; submitBtn.disabled=false; playAgainBtn.style.display='none';
  hideIncorrectWordsBox();
  await loadWords();
  gameStarted=true; pickWord(); displayLocalLeaderboard();
});

submitBtn.addEventListener('click',checkGuess);
guessInput.addEventListener('keyup',(e)=>{if(e.key==='Enter') checkGuess();});

startBtn.addEventListener('click',()=>{
  score=0; lives=5; incorrectWords=[]; consecutiveFirstGuessCount=0; wrongGuessesForWord=0;
  scoreBox.textContent=`Score: ${score}`; livesBox.textContent=`Lives: ${lives}`;
  guessInput.disabled=false; submitBtn.disabled=false; playAgainBtn.style.display='none';
  hideIncorrectWordsBox(); pickWord(); gameStarted=true;
});

playAgainBtn.addEventListener('click',()=>{
  score=0; lives=5; incorrectWords=[]; consecutiveFirstGuessCount=0; wrongGuessesForWord=0;
  scoreBox.textContent=`Score: ${score}`; livesBox.textContent=`Lives: ${lives}`;
  guessInput.disabled=false; submitBtn.disabled=false; playAgainBtn.style.display='none';
  hideIncorrectWordsBox(); pickWord(); gameStarted=true;
});

displayLocalLeaderboard();
</script>
</body>
</html>
