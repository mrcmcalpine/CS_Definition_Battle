<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Word Guess Challenge</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg,#6a11cb,#2575fc); color:#fff; text-align:center; padding:20px; min-height:100vh; display:flex; flex-direction:column; align-items:center; }
    h1 { font-size:2.2rem; margin-bottom:14px }
    #clueBox,#wordBox,#livesBox,#scoreBox,#feedback,#incorrectWordsBox { margin:10px 0; font-size:1.1rem; }
    #clueBox { text-align:left; max-width:560px }
    .clue { opacity:0; transform:translateY(10px); animation:fadeIn .45s ease forwards; margin:6px 0; padding:8px 12px; background:rgba(255,255,255,0.12); border-radius:8px }
    @keyframes fadeIn { to { opacity:1; transform:translateY(0) } }
    #wordBox { font-size:1.9rem; letter-spacing:8px; font-weight:700 }
    input[type=text] { padding:10px; font-size:1.05rem; border-radius:8px; border:none; outline:none; width:260px; text-align:center }
    button { padding:10px 18px; font-size:1rem; border:none; border-radius:20px; margin:6px; cursor:pointer; background:#fff; color:#2575fc; font-weight:700 }
    button:hover { transform:scale(1.04) }
    #leaderboard { margin-top:20px; background:rgba(255,255,255,0.08); padding:14px; border-radius:12px; width:320px }
    #leaderboardList { list-style:none; padding:0; text-align:left }
    #leaderboardList li { margin:6px 0 }
    #incorrectWordsBox { text-align:left; max-width:560px; background: rgba(0,0,0,0.15); padding:10px; border-radius:8px; display:none }
  </style>
</head>
<body>
  <h1>Word Guess Challenge üéØ</h1>

  <div id="namePrompt">
    Enter your name: <input type="text" id="playerNameInput" placeholder="Your name">
    <button id="submitNameBtn">Submit</button>
  </div>

  <div id="gameUI" style="display:none;">
    <div id="clueBox">Press Start to begin!</div>
    <div id="wordBox"></div>
    <div id="livesBox">Lives: 5</div>

    <input type="text" id="guessInput" placeholder="Type your guess here..." disabled>
    <div>
      <button id="submitBtn" disabled>Submit</button>
      <button id="startBtn">Start Game</button>
      <button id="playAgainBtn" style="display:none;">Play Again</button>
    </div>

    <div id="feedback"></div>
    <div id="scoreBox">Score: 0</div>

    <div id="incorrectWordsBox"></div>

    <div id="leaderboard">
      <h3>Leaderboard üèÜ</h3>
      <ul id="leaderboardList"></ul>
    </div>
  </div>

  <script>
    // -----------------------------
    // CONFIG: path to words.json
    // -----------------------------
    const WORDS_JSON_PATH = './words.json'; // ensure this file is in same folder as index.html

    // Game state
    let words = [];
    let currentWord = null;
    let clueIndex = 0;
    let score = 0;
    let lives = 5;
    let revealedLetters = [];
    let gameStarted = false;
    let playerName = '';

    // Tracking
    let incorrectWords = []; // only for current run
    let consecutiveFirstGuessCount = 0; // for extra life

    // DOM
    const namePrompt = document.getElementById('namePrompt');
    const playerNameInput = document.getElementById('playerNameInput');
    const submitNameBtn = document.getElementById('submitNameBtn');
    const gameUI = document.getElementById('gameUI');
    const clueBox = document.getElementById('clueBox');
    const wordBox = document.getElementById('wordBox');
    const livesBox = document.getElementById('livesBox');
    const guessInput = document.getElementById('guessInput');
    const submitBtn = document.getElementById('submitBtn');
    const startBtn = document.getElementById('startBtn');
    const playAgainBtn = document.getElementById('playAgainBtn');
    const scoreBox = document.getElementById('scoreBox');
    const feedback = document.getElementById('feedback');
    const leaderboardList = document.getElementById('leaderboardList');
    const incorrectWordsBox = document.getElementById('incorrectWordsBox');

    // -----------------------------
    // Utility: load words JSON
    // -----------------------------
    async function loadWords() {
      try {
        const res = await fetch(WORDS_JSON_PATH);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        words = await res.json();
        if (!Array.isArray(words) || words.length === 0) throw new Error('words.json must be a non-empty array');
      } catch (err) {
        clueBox.textContent = 'Error loading words.json ‚Äî make sure it is in the same folder as index.html and valid JSON.';
        console.error(err);
      }
    }

    // -----------------------------
    // Pick and display a word
    // -----------------------------
    function pickWord() {
      if (!words || words.length === 0) return;
      currentWord = words[Math.floor(Math.random() * words.length)];
      clueIndex = 0;
      revealedLetters = Array.from({length: currentWord.answer.length}, () => false);
      displayWordProgress();
      hideIncorrectWordsBox();
      showClues();
      feedback.textContent = '';
      guessInput.value = '';
      guessInput.maxLength = currentWord.answer.length;
    }

    function showClues() {
      clueBox.innerHTML = '';
      for (let i = 0; i <= clueIndex; i++) {
        if (currentWord && currentWord.clues && currentWord.clues[i]) {
          const d = document.createElement('div');
          d.className = 'clue';
          d.textContent = `Clue ${i+1}: ${currentWord.clues[i]}`;
          clueBox.appendChild(d);
        }
      }
    }

    function displayWordProgress() {
      if (!currentWord) return;
      let s = '';
      for (let i = 0; i < currentWord.answer.length; i++) s += (revealedLetters[i] ? currentWord.answer[i] : '_') + ' ';
      wordBox.textContent = s.trim();
    }

    function revealRandomLetter() {
      if (!currentWord) return;
      const unrevealed = [];
      for (let i = 0; i < currentWord.answer.length; i++) if (!revealedLetters[i]) unrevealed.push(i);
      if (unrevealed.length === 0) return;
      const idx = unrevealed[Math.floor(Math.random() * unrevealed.length)];
      revealedLetters[idx] = true;
      displayWordProgress();
    }

    // -----------------------------
    // Leaderboard (localStorage top-10)
    // -----------------------------
    function saveLocalLeaderboardEntry(name, value) {
      if (!name) return;
      let board = JSON.parse(localStorage.getItem('leaderboard') || '[]');
      board.push({name, score: value, ts: new Date().toISOString()});
      board.sort((a,b) => b.score - a.score);
      board = board.slice(0, 10);
      localStorage.setItem('leaderboard', JSON.stringify(board));
    }

    function displayLocalLeaderboard() {
      const board = JSON.parse(localStorage.getItem('leaderboard') || '[]');
      leaderboardList.innerHTML = '';
      board.forEach((e, i) => {
        const li = document.createElement('li');
        li.textContent = `${i+1}. ${e.name} - ${e.score}`;
        leaderboardList.appendChild(li);
      });
    }

    // -----------------------------
    // Incorrect words for this run
    // -----------------------------
    function showIncorrectWordsOnDeath() {
      if (!incorrectWords || incorrectWords.length === 0) {
        incorrectWordsBox.style.display = 'block';
        incorrectWordsBox.textContent = 'You had no incorrect words this run.';
        return;
      }
      incorrectWordsBox.style.display = 'block';
      incorrectWordsBox.innerHTML = '<strong>Words you got wrong this run:</strong><br>' + incorrectWords.join(', ');
    }

    function hideIncorrectWordsBox() {
      incorrectWordsBox.style.display = 'none';
      incorrectWordsBox.innerHTML = '';
    }

    // -----------------------------
    // Game logic: guess handling
    // -----------------------------
    function getPointsForClueIndex(idx) {
      if (idx === 0) return 5;
      if (idx === 1) return 3;
      if (idx === 2) return 1;
      return 0;
    }

    function checkGuess() {
      if (!gameStarted || !currentWord) return;
      const guess = guessInput.value.trim();
      if (!guess) return;

      const normalizedGuess = guess.toLowerCase();
      const normalizedAnswer = currentWord.answer.toLowerCase();

      if (normalizedGuess === normalizedAnswer) {
        // correct
        const points = getPointsForClueIndex(clueIndex);
        score += points;
        scoreBox.textContent = `Score: ${score}`;
        feedback.textContent = `‚úÖ Correct! +${points} points.`;

        // consecutive first-guess logic
        if (clueIndex === 0) {
          consecutiveFirstGuessCount++;
          if (consecutiveFirstGuessCount >= 3) {
            lives++;
            livesBox.textContent = `Lives: ${lives}`;
            feedback.textContent += ' üéâ 3 first-guess wins in a row ‚Äî extra life!';
            consecutiveFirstGuessCount = 0; // reset after awarding
          }
        } else {
          consecutiveFirstGuessCount = 0;
        }

        // move to next word after a short delay so player sees feedback
        setTimeout(() => pickWord(), 900);

      } else {
        // wrong guess
        clueIndex++;
        lives--;
        livesBox.textContent = `Lives: ${lives}`;
        feedback.textContent = '‚ùå Wrong!';
        consecutiveFirstGuessCount = 0; // reset streak on any non-first-guess-correct

        // reveal a random letter
        revealRandomLetter();

        // record this word as incorrect for this run (no duplicates)
        if (!incorrectWords.includes(currentWord.answer)) incorrectWords.push(currentWord.answer);

        // if lives depleted, game over
        if (lives <= 0) {
          // game over sequence
          feedback.textContent = `üíÄ Game Over! The word was: ${currentWord.answer}`;
          guessInput.disabled = true;
          submitBtn.disabled = true;
          playAgainBtn.style.display = 'inline-block';
          gameStarted = false;

          // show incorrect words only at death
          showIncorrectWordsOnDeath();

          // save leaderboard entry (local top-10)
          saveLocalLeaderboardEntry(playerName, score);
          displayLocalLeaderboard();
        } else {
          // show next clues (if any)
          showClues();
        }
      }

      guessInput.value = '';
    }

    // -----------------------------
    // UI handlers
    // -----------------------------
    submitNameBtn.addEventListener('click', async () => {
      const name = playerNameInput.value.trim();
      if (!name) { alert('Please enter a display name'); return; }
      playerName = name;
      namePrompt.style.display = 'none';
      gameUI.style.display = 'block';

      // init
      score = 0; lives = 5; incorrectWords = []; consecutiveFirstGuessCount = 0;
      scoreBox.textContent = `Score: ${score}`;
      livesBox.textContent = `Lives: ${lives}`;
      guessInput.disabled = false;
      submitBtn.disabled = false;
      playAgainBtn.style.display = 'none';
      hideIncorrectWordsBox();

      // load words then pick first word
      await loadWords();
      pickWord();
      displayLocalLeaderboard();
    });

    submitBtn.addEventListener('click', checkGuess);
    guessInput.addEventListener('keyup', (e) => { if (e.key === 'Enter') checkGuess(); });

    startBtn.addEventListener('click', () => {
      // restart the current run (clears run-specific incorrect words and streak)
      score = 0; lives = 5; incorrectWords = []; consecutiveFirstGuessCount = 0;
      scoreBox.textContent = `Score: ${score}`;
      livesBox.textContent = `Lives: ${lives}`;
      guessInput.disabled = false; submitBtn.disabled = false; playAgainBtn.style.display = 'none'; gameStarted = true;
      hideIncorrectWordsBox();
      pickWord();
    });

    playAgainBtn.addEventListener('click', () => {
      score = 0; lives = 5; incorrectWords = []; consecutiveFirstGuessCount = 0;
      scoreBox.textContent = `Score: ${score}`;
      livesBox.textContent = `Lives: ${lives}`;
      guessInput.disabled = false; submitBtn.disabled = false; playAgainBtn.style.display = 'none'; gameStarted = true;
      hideIncorrectWordsBox();
      pickWord();
    });

    // when page loads, show any saved leaderboard
    displayLocalLeaderboard();
  </script>
</body>
</html>
